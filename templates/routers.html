{% extends "layout.html" %}
{% block content %}
<div class="flex items-start justify-between gap-4 flex-wrap">
  <div>
    <div class="text-2xl font-semibold">Routers</div>
    <div class="text-sm text-slate-500">Create routers and secrets for HMAC API authentication.</div>
  </div>

  <form method="post" class="bg-white border border-slate-200 rounded-2xl p-4 w-full md:w-[640px]">
    <input type="hidden" name="csrf" value="{{ csrf }}">
    <input type="hidden" name="action" value="create">
    <div class="font-semibold mb-3">Add Router</div>
    {% if err %}<div class="mb-3 text-sm text-rose-700">{{ err }}</div>{% endif %}
    <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
      <div class="md:col-span-1">
        <label class="text-xs text-slate-500">Router ID</label>
        <input name="router_id" class="w-full h-10 px-3 rounded-xl border border-slate-200" maxlength="32" required>
      </div>
      <div class="md:col-span-2">
        <label class="text-xs text-slate-500">Name</label>
        <input name="name" class="w-full h-10 px-3 rounded-xl border border-slate-200" maxlength="64" required>
      </div>
      {% if isSuper %}
      <div class="md:col-span-3">
        <label class="text-xs text-slate-500">Owner (Operator)</label>
        <select name="owner_user_id" class="w-full h-10 px-3 rounded-xl border border-slate-200" required>
          <option value="">Select operator</option>
          {% for o in operators %}
            <option value="{{ o.id }}">{{ o.username }}</option>
          {% endfor %}
        </select>
      </div>
      {% endif %}
      <div class="md:col-span-3">
        <label class="text-xs text-slate-500">Secret</label>
        <input name="secret" class="w-full h-10 px-3 rounded-xl border border-slate-200" placeholder="Leave blank to auto-generate">
      </div>
    </div>
    <button class="mt-4 h-10 px-4 rounded-xl bg-slate-900 text-white hover:bg-slate-800">Create</button>
  </form>
</div>

<div class="mt-6 bg-white border border-slate-200 rounded-2xl overflow-hidden">
  <div class="p-4 border-b border-slate-200 font-semibold">Routers</div>
  <div class="overflow-x-auto">
    <table class="min-w-full text-sm">
      <thead class="bg-slate-50 text-slate-600">
        <tr>
          <th class="text-left px-4 py-3">Router ID</th>
          <th class="text-left px-4 py-3">Name</th>
          {% if isSuper %}<th class="text-left px-4 py-3">Owner</th>{% endif %}
          <th class="text-left px-4 py-3">Enabled</th>
          <th class="text-right px-4 py-3">Action</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-slate-200">
        {% for r in routers %}
        <tr>
          <td class="px-4 py-3 font-mono">{{ r.router_id }}</td>
          <td class="px-4 py-3">{{ r.name }}</td>
          {% if isSuper %}<td class="px-4 py-3">{{ r.owner_username }}</td>{% endif %}
          <td class="px-4 py-3">{{ 'Yes' if r.enabled==1 else 'No' }}</td>
          <td class="px-4 py-3 text-right">
            <form method="post" class="inline">
              <input type="hidden" name="csrf" value="{{ csrf }}">
              <input type="hidden" name="action" value="delete">
              <input type="hidden" name="router_id" value="{{ r.router_id }}">
              <button class="text-rose-700 hover:underline" onclick="return confirm('Delete router?')">Delete</button>
            </form>
          </td>
        </tr>
        {% else %}
        <tr><td class="px-4 py-6 text-slate-500" colspan="{{ 5 if isSuper else 4 }}">No routers</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
